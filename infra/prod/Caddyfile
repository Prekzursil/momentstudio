{
	# Optional: set in infra/prod/.env (CADDY_EMAIL=...)
	email {$CADDY_EMAIL}
}

# Redirect www -> apex to keep a single canonical origin (payments + localStorage).
www.{$PUBLIC_DOMAIN} {
	redir https://{$PUBLIC_DOMAIN}{uri} permanent
}

# momentstudio.ro (production)
{$PUBLIC_DOMAIN} {
	encode zstd gzip

	@api path /api/*
	handle @api {
		reverse_proxy backend:8000
	}

	@media path /media/*
	handle @media {
		reverse_proxy backend:8000
	}

	@robots path /robots.txt
	handle @robots {
		rewrite * /api/v1/robots.txt
		reverse_proxy backend:8000
	}

	@sitemap path /sitemap.xml
	handle @sitemap {
		rewrite * /api/v1/sitemap.xml
		reverse_proxy backend:8000
	}

	# Everything else is served by the frontend (Angular build).
	handle {
		header {
			Referrer-Policy "no-referrer"
			X-Content-Type-Options "nosniff"
			X-Frame-Options "DENY"
			Permissions-Policy "geolocation=(), microphone=(), camera=()"
			Content-Security-Policy "default-src 'self'; base-uri 'self'; object-src 'none'; frame-ancestors 'none'; img-src 'self' data: https:; style-src 'self' 'unsafe-inline'; script-src 'self' https://challenges.cloudflare.com; connect-src 'self' https:; frame-src https://challenges.cloudflare.com; manifest-src 'self'; font-src 'self' data:;"
		}
		reverse_proxy frontend:80
	}
}
