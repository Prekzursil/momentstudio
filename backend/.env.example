APP_NAME="momentstudio API"
APP_VERSION=0.1.0
ENVIRONMENT=local

DATABASE_URL=postgresql+asyncpg://postgres:postgres@localhost:5432/adrianaart
# Optional Postgres connection pool sizing for the API engine (leave empty to use SQLAlchemy defaults).
DB_POOL_SIZE=
DB_MAX_OVERFLOW=
# Dev safety: refuse to boot with ENVIRONMENT=local when DATABASE_URL points to a non-local host.
# This protects against accidentally copying a production .env locally.
DEV_SAFETY_DATABASE_GUARD_ENABLED=1
DEV_SAFETY_DATABASE_ALLOW_HOSTS=["localhost","127.0.0.1","db"]
# Optional Redis (recommended for multi-replica deployments; used for shared rate limiting/caches)
REDIS_URL=
# Optional: ISO8601 timestamp for the most recent backup. Shown in the Admin dashboard system health panel.
BACKUP_LAST_AT=
# Admin order document export retention (days). Set to 0 to disable expiry.
ORDER_EXPORT_RETENTION_DAYS=30
# Required in production. For local development you can leave it empty; the app will generate a per-process value.
# Generate a strong value (example): python -c "import secrets; print(secrets.token_hex(32))"
SECRET_KEY=
# Payments provider mode.
# - real: use Stripe/PayPal APIs (default)
# - mock: deterministic local-only provider for CI/E2E (never use in production)
PAYMENTS_PROVIDER=real
# Stripe env toggle (sandbox | live). Prefer *_SANDBOX/*_LIVE; *_TEST + legacy STRIPE_* vars are supported as fallbacks.
STRIPE_ENV=sandbox
STRIPE_SECRET_KEY_SANDBOX=
STRIPE_SECRET_KEY_TEST=
STRIPE_SECRET_KEY_LIVE=
STRIPE_WEBHOOK_SECRET_SANDBOX=
STRIPE_WEBHOOK_SECRET_TEST=
STRIPE_WEBHOOK_SECRET_LIVE=
STRIPE_PUBLISHABLE_KEY_SANDBOX=
STRIPE_PUBLISHABLE_KEY_TEST=
STRIPE_PUBLISHABLE_KEY_LIVE=
# Legacy fallbacks (avoid in production)
STRIPE_SECRET_KEY=
STRIPE_WEBHOOK_SECRET=
STRIPE_PUBLISHABLE_KEY=
# One of: sandbox | live
PAYPAL_ENV=sandbox
# PayPal settlement currency for checkout.
# Supported by our backend: RON | EUR | USD (RON skips FX conversion).
PAYPAL_CURRENCY=RON
# Optional PayPal support for checkout (redirect-based). Also enable PAYPAL_ENABLED on the frontend.
# Recommended: provide both sandbox + live credentials and switch using PAYPAL_ENV.
PAYPAL_CLIENT_ID_SANDBOX=
PAYPAL_CLIENT_SECRET_SANDBOX=
PAYPAL_WEBHOOK_ID_SANDBOX=
PAYPAL_CLIENT_ID_LIVE=
PAYPAL_CLIENT_SECRET_LIVE=
PAYPAL_WEBHOOK_ID_LIVE=
# Legacy single-env vars (fallback; prefer *_SANDBOX/*_LIVE)
PAYPAL_CLIENT_ID=
PAYPAL_CLIENT_SECRET=
PAYPAL_WEBHOOK_ID=
# Optional Netopia support for checkout (redirect-based). Leave disabled until configured.
NETOPIA_ENABLED=0
# One of: sandbox | live
NETOPIA_ENV=sandbox
# Netopia IPN (webhook) signature verification
# - The IPN request includes a `Verification-token` header (JWT) signed by Netopia.
# - Configure your POS signature + the Netopia public key (PEM) so the backend can verify callbacks.
# Recommended: provide both sandbox + live credentials and switch using NETOPIA_ENV.
# API key generated in NETOPIA Payments admin panel (required to start payments / check status).
# Public key can be provided either as inline PEM text or as a file path (PEM or .cer DER).
# Sandbox
NETOPIA_API_KEY_SANDBOX=
NETOPIA_POS_SIGNATURE_SANDBOX=
NETOPIA_PUBLIC_KEY_PEM_SANDBOX=
NETOPIA_PUBLIC_KEY_PATH_SANDBOX=
# Live
NETOPIA_API_KEY_LIVE=
NETOPIA_POS_SIGNATURE_LIVE=
NETOPIA_PUBLIC_KEY_PEM_LIVE=
NETOPIA_PUBLIC_KEY_PATH_LIVE=
# Legacy single-env vars (fallback; prefer *_SANDBOX/*_LIVE)
NETOPIA_API_KEY=
NETOPIA_POS_SIGNATURE=
NETOPIA_PUBLIC_KEY_PEM=
NETOPIA_PUBLIC_KEY_PATH=
NETOPIA_JWT_ALG=RS512
JWT_ALGORITHM=HS256
ACCESS_TOKEN_EXP_MINUTES=30
REFRESH_TOKEN_EXP_DAYS=7
REFRESH_TOKEN_ROTATION_GRACE_SECONDS=60
ACCOUNT_DELETION_COOLDOWN_HOURS=24
ACCOUNT_DELETION_SCHEDULER_ENABLED=1
ACCOUNT_DELETION_POLL_INTERVAL_SECONDS=600
ACCOUNT_DELETION_BATCH_LIMIT=200

# Pending payment orders can reserve stock; expire them after a TTL to free inventory.
ORDER_PENDING_PAYMENT_EXPIRY_ENABLED=1
ORDER_PENDING_PAYMENT_EXPIRY_MINUTES=120
ORDER_PENDING_PAYMENT_EXPIRY_POLL_INTERVAL_SECONDS=600
ORDER_PENDING_PAYMENT_EXPIRY_BATCH_LIMIT=200

SMTP_HOST=localhost
SMTP_PORT=1025
SMTP_USERNAME=
SMTP_PASSWORD=
SMTP_ENABLED=0
SMTP_USE_TLS=0
SMTP_FROM_EMAIL=
# Optional RFC 2369 mailto fallback for List-Unsubscribe (some clients prefer this).
# Example: unsubscribe@momentstudio.ro
LIST_UNSUBSCRIBE_MAILTO=

# Operational notifications (fallback when no owner is bootstrapped)
ADMIN_ALERT_EMAIL=
ERROR_ALERT_EMAIL=

FRONTEND_ORIGIN=http://localhost:4200

# Admin access controls (optional)
# - Allow/deny list values are CIDRs or single IPs, expressed as JSON lists.
# - By default the app uses `request.client.host`. If you are behind a reverse proxy, set ADMIN_IP_HEADER to a trusted
#   header name (e.g. X-Forwarded-For, CF-Connecting-IP) and ensure your proxy strips spoofed values.
# - ADMIN_IP_BYPASS_TOKEN can be used to temporarily bypass IP checks (sets a short-lived HttpOnly cookie).
MAINTENANCE_MODE=0
# Optional. If set, requests with header X-Maintenance-Bypass matching this token will bypass maintenance mode.
# Required in production if you want a bypass mechanism.
MAINTENANCE_BYPASS_TOKEN=
# Content preview token for /api/v1/content/admin/{key}/preview endpoints.
# Required in production; generate a strong random value.
CONTENT_PREVIEW_TOKEN=
# Require a second factor (TOTP/passkey) before owner/admin users can access the admin APIs.
# Recommended: keep enabled in production.
ADMIN_MFA_REQUIRED=0
ADMIN_IP_ALLOWLIST=[]
ADMIN_IP_DENYLIST=[]
ADMIN_IP_HEADER=
ADMIN_IP_BYPASS_TOKEN=
ADMIN_IP_BYPASS_COOKIE_MINUTES=30

# Audit retention (optional; 0 disables purging)
# These values control how long audit rows are kept for the Admin dashboard audit log.
AUDIT_RETENTION_DAYS_PRODUCT=0
AUDIT_RETENTION_DAYS_CONTENT=0
AUDIT_RETENTION_DAYS_SECURITY=0

# Optional tamper-evident audit hashes (hash-chain). When enabled, each audit row stores a hash that includes the
# previous hash + row data. Use a distinct secret so DB writes alone can't forge valid chains.
AUDIT_HASH_CHAIN_ENABLED=0
AUDIT_HASH_CHAIN_SECRET=

# WebAuthn / Passkeys
# - WEBAUTHN_RP_ID defaults to the hostname from FRONTEND_ORIGIN (recommended).
# - WEBAUTHN_ALLOWED_ORIGINS defaults to FRONTEND_ORIGIN; set it to a JSON list for additional origins.
WEBAUTHN_CHALLENGE_EXP_MINUTES=10
WEBAUTHN_RP_ID=
WEBAUTHN_RP_NAME=
WEBAUTHN_ALLOWED_ORIGINS=[]

# Optional storage roots
# - MEDIA_ROOT is for public assets served by the backend (product images, user avatars).
# - PRIVATE_MEDIA_ROOT is for admin-only files (e.g., shipping labels); it is not exposed as a public static dir.
MEDIA_ROOT=uploads
PRIVATE_MEDIA_ROOT=private_uploads
MEDIA_DAM_QUEUE_KEY=media:jobs:queue
MEDIA_DAM_TRASH_RETENTION_DAYS=30
MEDIA_PRIVATE_PREVIEW_TTL_SECONDS=600
MEDIA_DAM_WORKER_HEARTBEAT_PREFIX=media:workers:heartbeat
MEDIA_DAM_WORKER_HEARTBEAT_TTL_SECONDS=30
MEDIA_DAM_WORKER_HEARTBEAT_FILE=/tmp/media-worker-heartbeat.json
MEDIA_DAM_PROCESSING_STALE_SECONDS=600
MEDIA_DAM_RETRY_MAX_ATTEMPTS=5
MEDIA_DAM_RETRY_SWEEP_SECONDS=10
MEDIA_USAGE_RECONCILE_ENABLED=1
MEDIA_USAGE_RECONCILE_INTERVAL_SECONDS=86400
MEDIA_USAGE_RECONCILE_BATCH_SIZE=200
# Admin uploads (product images, CMS assets, shipping labels) can be large.
# Set a ceiling to avoid accidental disk exhaustion; keep this reasonably bounded even for admin-only endpoints.
# If unset/0, the backend falls back to a safe default (512MB).
ADMIN_UPLOAD_MAX_BYTES=536870912
# Optional upload hardening (raster images)
UPLOAD_IMAGE_MAX_WIDTH=8192
UPLOAD_IMAGE_MAX_HEIGHT=8192
UPLOAD_IMAGE_MAX_PIXELS=40000000

# Optional CAPTCHA (Cloudflare Turnstile) for auth + blog comments (Google OAuth is exempt)
CAPTCHA_ENABLED=0
CAPTCHA_PROVIDER=turnstile
TURNSTILE_SECRET_KEY=

# Blog comments: spam controls (optional)
BLOG_COMMENTS_RATE_LIMIT_COUNT=10
BLOG_COMMENTS_RATE_LIMIT_WINDOW_SECONDS=60
BLOG_COMMENTS_MAX_LINKS=2

# Analytics ingestion (optional)
# - ANALYTICS_REQUIRE_TOKEN enables a short-lived signed token for /api/v1/analytics/events.
# - The frontend will fetch tokens from /api/v1/analytics/token and send them via X-Analytics-Token.
ANALYTICS_RATE_LIMIT_EVENTS=120
ANALYTICS_REQUIRE_TOKEN=0
ANALYTICS_TOKEN_TTL_SECONDS=86400

# Cookie security (production)
# - SECURE_COOKIES=1 ensures cookies are only sent over HTTPS.
# - SameSite=lax works well for typical auth flows (including Google OAuth redirects).
SECURE_COOKIES=0
COOKIE_SAMESITE=lax

# Google OAuth (optional)
GOOGLE_CLIENT_ID=
GOOGLE_CLIENT_SECRET=
# Must match the frontend callback route:
# - Local dev: http://localhost:4200/auth/google/callback
# - Docker dev: http://localhost:4201/auth/google/callback
# - Production: https://momentstudio.ro/auth/google/callback
GOOGLE_REDIRECT_URI=
# Optional: restrict Google sign-in to specific domains (JSON list), e.g. ["example.com"].
GOOGLE_ALLOWED_DOMAINS=[]
# Optional Google OAuth completion
GOOGLE_COMPLETION_TOKEN_EXP_MINUTES=30

# Optional FX rates source/caching (used for display-only approximations; checkout remains in RON)
FX_RATES_URL=https://www.bnr.ro/nbrfxrates.xml
FX_RATES_CACHE_TTL_SECONDS=21600
FX_REFRESH_ENABLED=0
FX_REFRESH_INTERVAL_SECONDS=21600

# Locker lookup (Sameday/FANbox)
# By default the app requires official courier credentials for locker pickup selection.
# You can enable an Overpass (OpenStreetMap) fallback for local development only.
SAMEDAY_MIRROR_ENABLED=1
SAMEDAY_MIRROR_SYNC_INTERVAL_SECONDS=2592000
SAMEDAY_MIRROR_STALE_AFTER_SECONDS=2592000
SAMEDAY_MIRROR_FETCH_TIMEOUT_SECONDS=30
SAMEDAY_MIRROR_MAX_LOCKERS=20000
SAMEDAY_MIRROR_PLAYWRIGHT_ENABLED=1
SAMEDAY_MIRROR_CHALLENGE_FAILURE_ALERT_STREAK=3
SAMEDAY_MIRROR_SCHEMA_DRIFT_RATIO_DROP=0.20
SAMEDAY_MIRROR_SCHEMA_DRIFT_MIN_RATIO=0.80
LOCKERS_USE_OVERPASS_FALLBACK=0
SAMEDAY_API_BASE_URL=
SAMEDAY_API_USERNAME=
SAMEDAY_API_PASSWORD=
FAN_API_BASE_URL=https://api.fancourier.ro
FAN_API_USERNAME=
FAN_API_PASSWORD=

# Optional Sentry DSN for backend error reporting
SENTRY_DSN=
SENTRY_ENABLE_LOGS=1
SENTRY_LOG_LEVEL=info
SENTRY_PROFILES_SAMPLE_RATE=1.0
SENTRY_SEND_DEFAULT_PII=1
SENTRY_TRACES_SAMPLE_RATE=1.0
